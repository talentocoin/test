!function(r,e){function t(r){if(r&&("number"!=typeof r||r%1!==0||r<w.minBits||r>w.maxBits))throw new Error("Number of bits must be an integer between "+w.minBits+" and "+w.maxBits+", inclusive.");p.radix=w.radix,p.bits=r||w.bits,p.size=Math.pow(2,p.bits),p.max=p.size-1;for(var e=[],t=[],n=1,i=w.primitivePolynomials[p.bits],a=0;a<p.size;a++)t[a]=n,e[n]=a,n<<=1,n>=p.size&&(n^=i,n&=p.max);p.logs=e,p.exps=t}function n(){return p.bits&&p.size&&p.max&&p.logs&&p.exps&&p.logs.length===p.size&&p.exps.length===p.size?!0:!1}function i(){function r(r,e,t,n){for(var i="",a=0,o=e.length-1;o>a||i.length<r;)i+=b(parseInt(e[a],t).toString(2),n),a++;return i=i.substr(-r),(i.match(/0/g)||[]).length===i.length?null:i}var t,n;if("function"==typeof require&&(n=require("crypto"))&&(t=n.randomBytes))return function(e){for(var n=Math.ceil(e/8),i=null;null===i;)i=r(e,t(n).toString("hex"),16,4);return i};if(e.crypto&&"function"==typeof e.crypto.getRandomValues&&"function"==typeof e.Uint32Array)return n=e.crypto,function(t){for(var i=Math.ceil(t/32),a=null,o=new e.Uint32Array(i);null===a;)n.getRandomValues(o),a=r(t,o,10,32);return a};p.unsafePRNG=!0,a();var i=32,o=Math.pow(2,i)-1;return function(e){for(var t=Math.ceil(e/i),n=[],a=null;null===a;){for(var s=0;t>s;s++)n[s]=Math.floor(Math.random()*o+1);a=r(e,n,10,i)}return a}}function a(){e.console.warn(w.warning),"function"==typeof e.alert&&p.alert&&e.alert(w.warning)}function o(){return"function"==typeof p.rng}function s(r,e){for(var t=p.logs[r],n=0,i=e.length-1;i>=0;i--)n=0!==n?p.exps[(t+p.logs[n])%p.max]^e[i]:e[i];return n}function u(r,e){for(var t=0,n=r.length;n>t;t++)if(r[t]===e)return!0;return!1}function f(r){var e=parseInt(r[0],36);if(e&&("number"!=typeof e||e%1!==0||e<w.minBits||e>w.maxBits))throw new Error("Number of bits must be an integer between "+w.minBits+" and "+w.maxBits+", inclusive.");var t=Math.pow(2,e)-1,n=t.toString(p.radix).length,i=parseInt(r.substr(1,n),p.radix);if("number"!=typeof i||i%1!==0||1>i||i>t)throw new Error("Share id must be an integer between 1 and "+p.max+", inclusive.");if(r=r.substr(n+1),!r.length)throw new Error("Invalid share: zero-length share.");return{bits:e,id:i,value:r}}function h(r,e){for(var n,i,a,o=[],s=[],h="",w=0,d=e.length;d>w;w++){if(i=f(e[w]),"undefined"==typeof n)n=i.bits;else if(i.bits!==n)throw new Error("Mismatched shares: Different bit settings.");if(p.bits!==n&&t(n),!u(o,i.id)){a=o.push(i.id)-1,i=g(c(i.value));for(var v=0,y=i.length;y>v;v++)s[v]=s[v]||[],s[v][a]=i[v]}}for(var w=0,d=s.length;d>w;w++)h=b(l(r,o,s[w]).toString(2))+h;if(0===r){var a=h.indexOf("1");return m(h.slice(a+1))}return m(h)}function l(r,e,t){for(var n,i,a,o=0,i=0,s=e.length;s>i;i++)if(t[i]){n=p.logs[t[i]];for(var a=0;s>a;a++)if(i!==a){if(r===e[a]){n=-1;break}n=(n+p.logs[r^e[a]]-p.logs[e[i]^e[a]]+p.max)%p.max}o=-1===n?o:o^p.exps[n]}return o}function g(r,e){e&&(r=b(r,e));for(var t=[],n=r.length;n>p.bits;n-=p.bits)t.push(parseInt(r.slice(n-p.bits,n),2));return t.push(parseInt(r.slice(0,n),2)),t}function b(r,e){e=e||p.bits;var t=r.length%e;return(t?new Array(e-t+1).join("0"):"")+r}function c(r){for(var e,t="",n=r.length-1;n>=0;n--){if(e=parseInt(r[n],16),isNaN(e))throw new Error("Invalid hex character.");t=b(e.toString(2),4)+t}return t}function m(r){var e,t="";r=b(r,4);for(var n=r.length;n>=4;n-=4){if(e=parseInt(r.slice(n-4,n),2),isNaN(e))throw new Error("Invalid binary character.");t=e.toString(16)+t}return t}var w={bits:8,radix:16,minBits:3,maxBits:20,bytesPerChar:2,maxBytesPerChar:6,primitivePolynomials:[null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],warning:"WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!"},p={};r.getConfig=function(){return{bits:p.bits,unsafePRNG:p.unsafePRNG}},r.init=t,r.setRNG=function(r,e){if(n()||this.init(),p.unsafePRNG=!1,r=r||i(),"function"!=typeof r||"string"!=typeof r(p.bits)||!parseInt(r(p.bits),2)||r(p.bits).length>p.bits||r(p.bits).length<p.bits)throw new Error("Random number generator is invalid. Supply an RNG of the form function(bits){} that returns a string containing 'bits' number of random 1's and 0's.");return p.rng=r,p.alert=!!e,!!p.unsafePRNG},r.random=function(r){if(o()||this.setRNG(),"number"!=typeof r||r%1!==0||2>r)throw new Error("Number of bits must be an integer greater than 1.");return p.unsafePRNG&&a(),m(p.rng(r))},r.share=function(r,e,t,i,s){if(n()||this.init(),o()||this.setRNG(),i=i||0,"string"!=typeof r)throw new Error("Secret must be a string.");if("number"!=typeof e||e%1!==0||2>e)throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+p.max+"), inclusive.");if(e>p.max){var u=Math.ceil(Math.log(e+1)/Math.LN2);throw new Error("Number of shares must be an integer between 2 and 2^bits-1 ("+p.max+"), inclusive. To create "+e+" shares, use at least "+u+" bits.")}if("number"!=typeof t||t%1!==0||2>t)throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+p.max+"), inclusive.");if(t>p.max){var u=Math.ceil(Math.log(t+1)/Math.LN2);throw new Error("Threshold number of shares must be an integer between 2 and 2^bits-1 ("+p.max+"), inclusive.  To use a threshold of "+t+", use at least "+u+" bits.")}if("number"!=typeof i||i%1!==0)throw new Error("Zero-pad length must be an integer greater than 1.");p.unsafePRNG&&a(),r="1"+c(r),r=g(r,i);for(var f=new Array(e),h=new Array(e),l=0,w=r.length;w>l;l++)for(var d=this._getShares(r[l],e,t),v=0;e>v;v++)f[v]=f[v]||d[v].x.toString(p.radix),h[v]=b(d[v].y.toString(2))+(h[v]?h[v]:"");var y=p.max.toString(p.radix).length;if(s)for(var l=0;e>l;l++)f[l]=m(h[l]);else for(var l=0;e>l;l++)f[l]=p.bits.toString(36).toUpperCase()+b(f[l],y)+m(h[l]);return f},r._getShares=function(r,e,t){for(var n=[],i=[r],a=1;t>a;a++)i[a]=parseInt(p.rng(p.bits),2);for(var a=1,o=e+1;o>a;a++)n[a-1]={x:a,y:s(a,i)};return n},r._processShare=f,r.combine=function(r){return h(0,r)},r.newShare=function(r,e){"string"==typeof r&&(r=parseInt(r,p.radix));var t=f(e[0]),n=Math.pow(2,t.bits)-1;if("number"!=typeof r||r%1!==0||1>r||r>n)throw new Error("Share id must be an integer between 1 and "+p.max+", inclusive.");var i=n.toString(p.radix).length;return p.bits.toString(36).toUpperCase()+b(r.toString(p.radix),i)+h(r,e)},r._lagrange=l,r.str2hex=function(r,e){if("string"!=typeof r)throw new Error("Input must be a character string.");if(e=e||w.bytesPerChar,"number"!=typeof e||e%1!==0||1>e||e>w.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+w.maxBytesPerChar+", inclusive.");for(var t,n=2*e,i=Math.pow(16,n)-1,a="",o=0,s=r.length;s>o;o++){if(t=r[o].charCodeAt(),isNaN(t))throw new Error("Invalid character: "+r[o]);if(t>i){var u=Math.ceil(Math.log(t+1)/Math.log(256));throw new Error("Invalid character code ("+t+"). Maximum allowable is 256^bytes-1 ("+i+"). To convert this character, use at least "+u+" bytes.")}a=b(t.toString(16),n)+a}return a},r.hex2str=function(r,e){if("string"!=typeof r)throw new Error("Input must be a hexadecimal string.");if(e=e||w.bytesPerChar,"number"!=typeof e||e%1!==0||1>e||e>w.maxBytesPerChar)throw new Error("Bytes per character must be an integer between 1 and "+w.maxBytesPerChar+", inclusive.");var t=2*e,n="";r=b(r,t);for(var i=0,a=r.length;a>i;i+=t)n=String.fromCharCode(parseInt(r.slice(i,i+t),16))+n;return n},r.init()}("undefined"!=typeof module&&module.exports?module.exports:window.secrets={},"undefined"!=typeof GLOBAL?GLOBAL:window);
